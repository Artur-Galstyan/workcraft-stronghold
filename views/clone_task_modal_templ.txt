<div><button onclick=\"cloneTaskModal.showModal()\" class=\"btn btn-primary\">Clone Task</button> <dialog id=\"cloneTaskModal\" class=\"modal\"><div class=\"modal-box max-w-2xl\"><h3 class=\"text-lg font-bold mb-4\">Clone Task</h3><form id=\"clone-task-form\" class=\"space-y-4\"><div class=\"form-control w-full\"><label class=\"label\"><span class=\"label-text\">Task Name</span></label> <input type=\"text\" name=\"taskName\" id=\"clone-task-name\" class=\"input input-bordered w-full\" required></div><div class=\"form-control w-full\"><label class=\"label\"><span class=\"label-text\">Queue</span></label> <input type=\"text\" name=\"queue\" id=\"clone-task-queue\" class=\"input input-bordered w-full\"></div><div class=\"form-control w-full\"><label class=\"label\"><span class=\"label-text\">Payload (JSON)</span></label> <textarea name=\"payload\" id=\"clone-task-payload\" class=\"textarea textarea-bordered font-mono h-48\" required></textarea></div><div class=\"form-control\"><label class=\"label cursor-pointer\"><span class=\"label-text\">Retry on Failure</span> <input type=\"checkbox\" name=\"retryOnFailure\" id=\"clone-task-retry\" class=\"checkbox\"></label></div><div class=\"form-control w-full\"><label class=\"label\"><span class=\"label-text\">Retry Limit</span></label> <input type=\"number\" name=\"retryLimit\" id=\"clone-task-retry-limit\" class=\"input input-bordered w-full\" min=\"0\" value=\"0\"></div><div class=\"modal-action\"><button type=\"submit\" class=\"btn btn-primary\">Create Task</button> <button type=\"button\" class=\"btn\" onclick=\"cloneTaskModal.close()\">Cancel</button></div></form></div><form method=\"dialog\" class=\"modal-backdrop\"><button>close</button></form></dialog><script defer>\n        $(document).ready(async function() {\n          const $modal = $('#cloneTaskModal');\n          const $form = $('#clone-task-form');\n          const taskID = JSON.parse($('#taskID').text());\n\n          const currentTaskReq = await fetch(`/api/task/${taskID}`)\n\n          if (!currentTaskReq.ok) {\n            window.Toast.fire({\n              icon: \"error\",\n              title: \"Failed to load task data\"\n            });\n            return;\n          }\n\n          const currentTask = await currentTaskReq.json();\n          if (!currentTask || currentTask.error) {\n            window.Toast.fire({\n              icon: \"error\",\n              title: \"Failed to load task data\"\n            });\n            return;\n          }\n          console.log(currentTask);\n          $('#clone-task-name').val(currentTask.task_name || '');\n          $('#clone-task-queue').val(currentTask.queue || 'DEFAULT');\n          $('#clone-task-payload').val(JSON.stringify(currentTask.payload || {}, null, 2));\n          $('#clone-task-retry').prop('checked', currentTask.retry_on_failure || false);\n          $('#clone-task-retry-limit').val(currentTask.retry_limit || 0);\n\n          $form.on('submit', async function(e) {\n            e.preventDefault();\n\n            try {\n              // Validate JSON payload\n              const payload = JSON.parse($('#clone-task-payload').val());\n              const randomUUID = window.getUUID();\n              // Prepare task data\n              const taskData = {\n                id: randomUUID,\n                task_name: $('#clone-task-name').val(),\n                queue: $('#clone-task-queue').val(),\n                payload: payload,\n                retry_on_failure: $('#clone-task-retry').is(':checked'),\n                retry_limit: parseInt($('#clone-task-retry-limit').val())\n              };\n\n              // Create new task\n              const newTaskReq = await fetch('/api/task', {\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(taskData)\n              });\n\n              if (!newTaskReq.ok) {\n                showError('Failed to create task: ' + await newTaskReq.text());\n                return;\n              }\n\n              const newTask = await newTaskReq.json();\n              window.Toast.fire({\n                icon: \"success\",\n                title: \"Task created!\"\n              });\n\n              // Close modal\n              $modal[0].close();\n\n              // Redirect to new task\n              window.location.href = `/task/${newTask.id}`;\n\n            } catch (err) {\n              showError('Invalid JSON payload: ' + err.message);\n            }\n          });\n        });\n      </script></div>
